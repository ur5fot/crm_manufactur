# CRM на CSV (Vue + Node)

**[English version / Английская версия](README.md)**

Локальная CRM-система, которая хранит данные в CSV-файлах и PDF-документах. CSV-файлы можно безопасно редактировать в Excel, изменения автоматически загружаются при обновлении страницы.

## Возможности

- **Хранение в CSV** - не требуется база данных, редактируйте данные прямо в Excel
- **Последовательные числовые ID** - простые идентификаторы сотрудников (1, 2, 3...)
- **Управление файлами** - загрузка и хранение PDF-документов для каждого сотрудника
- **Единая таблица** - все данные сотрудника, включая телефон и образование, в одной таблице
- **Формы на основе справочников** - значения выпадающих списков управляются через CSV
- **Импорт CSV** - массовая загрузка сотрудников из CSV-файлов
- **UTF-8 с BOM** - корректная поддержка кириллицы в Excel

## Технологический стек

- **Frontend:** Vue 3 + Vite
- **Backend:** Node.js + Express
- **Хранилище:** CSV файлы (UTF-8 с BOM)
- **Загрузка файлов:** Multer

## Структура проекта

```
crm_manufactur/
├── data/
│   ├── employees.csv              # Основные данные сотрудников (37 полей)
│   └── dictionaries.csv           # Справочные данные для выпадающих списков
├── files/
│   └── employee_[ID]/             # Загруженные PDF-документы
├── server/                        # Backend на Express.js
└── client/                        # Frontend на Vue.js
```

## Быстрый старт

### Использование скрипта запуска

```bash
./run.sh
```

### Ручной запуск

**Терминал 1 (сервер):**

```bash
cd server
npm install
npm run dev
```

**Терминал 2 (клиент):**

```bash
cd client
npm install
npm run dev
```

Откройте `http://localhost:5173` в браузере.

## Формат CSV

- **Разделитель:** `;` (точка с запятой) для совместимости с Excel
- **Кодировка:** UTF-8 с BOM для корректного отображения кириллицы в Excel
- **Строка заголовков:** Должна оставаться неизменной
- **ID сотрудников:** Последовательные числа (1, 2, 3...) вместо UUID
- **Пути к файлам:** Хранятся как относительные пути типа `files/employee_1/passport.pdf`

## Модель данных

### Основные таблицы

- **employees.csv** - Основные записи сотрудников (37 полей):
  1. `employee_id` - ID сотрудника (автоинкремент)
  2. `last_name` - Фамилия
  3. `first_name` - Имя
  4. `middle_name` - Отчество
  5. `employment_status` - Статус работы (Работает, Отпуск, Уволен, Больничный)
  6. `additional_status` - Дополнительный статус
  7. `location` - Местонахождение
  8. `department` - Подразделение
  9. `position` - Должность
  10. `grade` - Разряд (словами)
  11. `salary_grid` - Зарплатная сетка
  12. `salary_amount` - Оклад
  13. `specialty` - Специальность
  14. `work_state` - Рабочее состояние
  15. `work_type` - Тип работы (Полная ставка, Частичная занятость, Контракт)
  16. `gender` - Пол (Мужской, Женский)
  17. `fit_status` - Пригодность (Годен, Не годен, Ограниченно годен)
  18. `order_ref` - Приказ
  19. `bank_name` - Банк
  20. `bank_card_number` - Номер карты
  21. `bank_iban` - IBAN
  22. `tax_id` - ИНН
  23. `email` - Эл. почта
  24. `blood_group` - Группа крови (I (0), II (A), III (B), IV (AB))
  25. `workplace_location` - Место работы
  26. `residence_place` - Место проживания
  27. `registration_place` - Место регистрации
  28. `driver_license_file` - Водительское удостоверение (файл)
  29. `id_certificate_file` - Удостоверение личности (файл)
  30. `foreign_passport_number` - Номер загранпаспорта
  31. `foreign_passport_issue_date` - Дата выдачи загранпаспорта
  32. `foreign_passport_file` - Загранпаспорт (файл)
  33. `criminal_record_file` - Справка о несудимости (файл)
  34. `phone` - Телефон
  35. `phone_note` - Примечание к телефону
  36. `education` - Образование
  37. `notes` - Примечание

- **dictionaries.csv** - Справочные данные для выпадающих списков:
  - dictionary_id, dictionary_type, value, label, order_index
  - Типы: gender (пол), blood_group (группа крови), employment_status (статус), work_type (тип работы), fit_status (пригодность)

## Детальное описание возможностей

### Загрузка файлов

Используйте раздел "Быстрая загрузка PDF" в интерфейсе для прикрепления PDF-файлов. Пути к файлам автоматически записываются в соответствующие колонки `employees.csv`.

Поддерживаемые типы документов:
- Водительское удостоверение
- Удостоверение личности
- Загранпаспорт
- Справка о несудимости

### Импорт CSV

Шаблон доступен в интерфейсе или по пути `data/employees_import_sample.csv`.

**Важно:** Файл шаблона содержит UTF-8 BOM и корректную кодировку для совместимости с Excel. Используйте его как образец для правильного форматирования.

**Правила импорта:**
- Кодировка UTF-8 с BOM, разделитель `;`, первая строка — заголовки
- Заголовки должны совпадать с английскими названиями колонок из `employees.csv`
- Можно использовать только часть колонок - пропущенные поля будут пустыми
- Обязательные поля: хотя бы `last_name` или `first_name`
- `employee_id` опционален:
  - Если пустой: генерируется автоматически (следующий номер по порядку)
  - Если заполнен и уже существует: строка пропускается
- Формат даты: `YYYY-MM-DD` (например, `foreign_passport_issue_date`)
- Импортируются все поля сотрудника: личные данные, работа, контакты (phone, phone_note), образование, документы и т.д.

### Управление справочниками

Все значения выпадающих списков в формах управляются через `data/dictionaries.csv`:

1. Откройте `dictionaries.csv` в Excel
2. Добавьте новые строки с полями:
   - `dictionary_id` - следующий номер по порядку
   - `dictionary_type` - тип справочника (gender, blood_group и т.д.)
   - `value` - значение для сохранения в базе
   - `label` - отображаемый текст
   - `order_index` - порядок сортировки
3. Сохраните файл с кодировкой UTF-8 BOM
4. Обновите страницу в браузере

## API Endpoints

- `GET /api/employees` - Список всех сотрудников
- `GET /api/employees/:id` - Получить данные сотрудника (возвращает объект сотрудника)
- `POST /api/employees` - Создать сотрудника (принимает объект сотрудника)
- `PUT /api/employees/:id` - Обновить сотрудника (принимает объект сотрудника)
- `DELETE /api/employees/:id` - Удалить сотрудника
- `POST /api/employees/:id/files` - Загрузить PDF-документ
- `POST /api/employees/import` - Массовый импорт из CSV
- `GET /api/dictionaries` - Получить все справочные данные
- `POST /api/open-data-folder` - Открыть папку data в проводнике ОС

## Разработка

Для детальной архитектуры и рекомендаций по разработке см. [CLAUDE.md](CLAUDE.md).

## Лицензия

MIT
