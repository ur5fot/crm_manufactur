# –ü—Ä–∏–∫–ª–∞–¥ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —Ñ—ñ—á—ñ —á–µ—Ä–µ–∑ BMAD

## –§—ñ—á–∞: –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç –∑ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—î—é

**–ú–µ—Ç–∞:** –î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–º—ñ–Ω –∑–∞—Ä–ø–ª–∞—Ç–∏ –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞ —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ü–µ —É –≤–∏–≥–ª—è–¥—ñ –≥—Ä–∞—Ñ—ñ–∫–∞.

---

## üìã –ö—Ä–æ–∫ 1: –î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è —Ç–∞ Design Thinking

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-cis-design-thinking
```

### –î—ñ–∞–ª–æ–≥ –∑ Claude:

**Claude:** –î–∞–≤–∞–π—Ç–µ –ø–æ—á–Ω–µ–º–æ –∑ —Ñ–∞–∑–∏ **Empathize**. –•—Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ü—ñ—î—ó —Ñ—ñ—á—ñ?

**–í–∏:** HR –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–∞ –∫–µ—Ä—ñ–≤–Ω–∏–∫–∏ –≤—ñ–¥–¥—ñ–ª—ñ–≤. –í–æ–Ω–∏ —Ö–æ—á—É—Ç—å –±–∞—á–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –ø—ñ–¥–≤–∏—â–µ–Ω—å –∑–∞—Ä–ø–ª–∞—Ç, –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç—Ä–µ–Ω–¥–∏, –≥–æ—Ç—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç–∏ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä—ñ—ó.

**Claude:** –Ø–∫—É –ø—Ä–æ–±–ª–µ–º—É —Ü–µ –≤–∏—Ä—ñ—à—É—î?

**–í–∏:** –ó–∞—Ä–∞–∑ —î —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç–æ—á–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞. –ö–æ–ª–∏ —Ö—Ç–æ—Å—å –∑–∞–ø–∏—Ç—É—î "–∫–æ–ª–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä–∞–∑ –ø—ñ–¥–≤–∏—â—É–≤–∞–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—É –Ü–≤–∞–Ω–æ–≤—É?", –¥–æ–≤–æ–¥–∏—Ç—å—Å—è —à—É–∫–∞—Ç–∏ –≤ –ø–∞–ø–µ—Ä–æ–≤–∏—Ö –Ω–∞–∫–∞–∑–∞—Ö –∞–±–æ –ª–æ–≥–∞—Ö –∑–º—ñ–Ω.

*(–ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è –¥—ñ–∞–ª–æ–≥ —á–µ—Ä–µ–∑ –≤—Å—ñ —Ñ–∞–∑–∏: Define, Ideate, Prototype, Test)*

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –†–æ–∑—É–º—ñ–Ω–Ω—è –ø–æ—Ç—Ä–µ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ö–ª—é—á–æ–≤—ñ use cases
- –ú–æ–∂–ª–∏–≤—ñ —Ä—ñ—à–µ–Ω–Ω—è

---

## üìù –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Product Brief

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-create-product-brief
```

### –î—ñ–∞–ª–æ–≥:

**Claude:** –Ø–∫–∞ –Ω–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É/—Ñ—ñ—á—ñ?

**–í–∏:** –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç (Salary History)

**Claude:** –û–ø–∏—à—ñ—Ç—å –æ—Å–Ω–æ–≤–Ω—É –ø—Ä–æ–±–ª–µ–º—É

**–í–∏:** –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–æ –∑–º—ñ–Ω–∏ –∑–∞—Ä–ø–ª–∞—Ç —É—Å–∫–ª–∞–¥–Ω—é—î –∞–Ω–∞–ª—ñ–∑ —Ç–∞ –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å

*(–¥—ñ–∞–ª–æ–≥ –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è)*

### –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª:
```
docs/product-brief-salary-history.md
```

### –ó–º—ñ—Å—Ç (–ø—Ä–∏–∫–ª–∞–¥):
```markdown
# Product Brief: –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç

## –ü—Ä–æ–±–ª–µ–º–∞
HR –º–µ–Ω–µ–¥–∂–µ—Ä–∏ –Ω–µ –º–∞—é—Ç—å —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω –∑–∞—Ä–ø–ª–∞—Ç...

## –†—ñ—à–µ–Ω–Ω—è
–î–æ–¥–∞—Ç–∏ —Å–µ–∫—Ü—ñ—é "–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç" –≤ –∫–∞—Ä—Ç–∫—É –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞...

## –¶—ñ–ª—å–æ–≤–∞ –∞—É–¥–∏—Ç–æ—Ä—ñ—è
- HR –º–µ–Ω–µ–¥–∂–µ—Ä–∏
- –ö–µ—Ä—ñ–≤–Ω–∏–∫–∏ –≤—ñ–¥–¥—ñ–ª—ñ–≤
- –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—ñ—è

## –ö–ª—é—á–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
1. –ü–µ—Ä–µ–≥–ª—è–¥ —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω –∑–∞—Ä–ø–ª–∞—Ç–∏
2. –ì—Ä–∞—Ñ—ñ–∫ –∑–º—ñ–Ω –∑–∞ —á–∞—Å–æ–º
3. –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –∑–º—ñ–Ω–∏ –∑–∞—Ä–ø–ª–∞—Ç–∏
4. –ï–∫—Å–ø–æ—Ä—Ç —ñ—Å—Ç–æ—Ä—ñ—ó –≤ CSV
```

---

## üìê –ö—Ä–æ–∫ 3: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è PRD (Product Requirements Document)

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-create-prd
```

**Claude:** –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π PRD –Ω–∞ –æ—Å–Ω–æ–≤—ñ Product Brief?

**–í–∏:** –¢–∞–∫

### –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª:
```
docs/prd-salary-history.md
```

### –ó–º—ñ—Å—Ç (–ø—Ä–∏–∫–ª–∞–¥):
```markdown
# PRD: –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç

## 1. Overview
**Feature:** Salary History Tracking
**Priority:** High
**Target Release:** Sprint 3

## 2. User Stories
- As HR manager, I want to see salary change history...
- As department head, I want to visualize salary growth...

## 3. Requirements

### 3.1 Functional
- FR-1: System shall store salary changes with date, amount, reason
- FR-2: System shall display salary history in chronological order
- FR-3: System shall generate line chart of salary changes
- FR-4: System shall allow adding new salary change entry

### 3.2 Non-functional
- NFR-1: History should load in <500ms
- NFR-2: Support minimum 50 salary changes per employee

## 4. Data Model
```csv
employee_id;change_date;old_salary;new_salary;reason;changed_by
```

## 5. UI/UX Requirements
- New tab "–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç" in employee card
- Table with columns: Date, Old, New, Change %, Reason
- Line chart below table
```

---

## üèóÔ∏è –ö—Ä–æ–∫ 4: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Architecture

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-create-architecture
```

### –î—ñ–∞–ª–æ–≥:

**Claude:** –Ø–∫—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–∏?

**–í–∏:**
1. –î–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é - –æ–∫—Ä–µ–º–∏–π CSV —á–∏ –≤ employees.csv?
2. –Ø–∫—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?
3. –Ø–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ª–æ–≥—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏ –∑–∞—Ä–ø–ª–∞—Ç?

*(Claude –∑–∞–¥–∞—î –ø–∏—Ç–∞–Ω–Ω—è, –¥–æ–ø–æ–º–∞–≥–∞—î –ø—Ä–∏–π–Ω—è—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è)*

### –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª:
```
docs/architecture-salary-history.md
```

### –ó–º—ñ—Å—Ç (–ø—Ä–∏–∫–ª–∞–¥):
```markdown
# Architecture Decision Record: Salary History

## Decision 1: –û–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª salary_history.csv
**Context:** –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–º—ñ–Ω –∑–∞—Ä–ø–ª–∞—Ç

**Options:**
A) –û–∫—Ä–µ–º–∏–π CSV —Ñ–∞–π–ª `salary_history.csv`
B) –î–æ–¥–∞—Ç–∏ –ø–æ–ª—è –≤ `employees.csv` (salary_history_json)
C) –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ SQLite

**Decision:** Option A - –æ–∫—Ä–µ–º–∏–π CSV

**Rationale:**
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ –∑ —ñ—Å–Ω—É—é—á–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é (CSV-based)
- –ü—Ä–æ—Å—Ç—ñ—à–µ –¥–ª—è backup —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É –≤ Excel
- –ù–µ–æ–±–º–µ–∂–µ–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤

## Decision 2: Chart.js –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó
**Decision:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Chart.js

**Rationale:**
- –õ–µ–≥–∫–æ–≤–∞–≥–∏–π (11KB gzipped)
- –ù–µ –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- –î–æ–±—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏

## Decision 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ PUT /api/employees/:id
**Decision:** Middleware –≤ Express –¥–ª—è –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç—É –∑–º—ñ–Ω

**Implementation:**
- –ü—Ä–∏ PUT –∑–∞–ø–∏—Ç—ñ –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ old vs new salary_amount
- –Ø–∫—â–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –∑–∞–ø–∏—Å –≤ salary_history.csv
- –ó–±–µ—Ä—ñ–≥–∞—Ç–∏: timestamp, employee_id, old, new, user (–∑ JWT token)
```

---

## üé® –ö—Ä–æ–∫ 5: UX Design (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-create-ux-design
```

**Claude:** –Ø–∫—ñ –µ–∫—Ä–∞–Ω–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–ø—Ä–æ—î–∫—Ç—É–≤–∞—Ç–∏?

**–í–∏:** –í–∫–ª–∞–¥–∫–∞ "–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç" –≤ –∫–∞—Ä—Ç—Ü—ñ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞

*(–¥—ñ–∞–ª–æ–≥ –ø—Ä–æ UI patterns, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, flows)*

### –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª:
```
docs/ux-design-salary-history.md
```

---

## üéØ –ö—Ä–æ–∫ 6: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥—ñ–∞–≥—Ä–∞–º

### 6.1 Data Flow Diagram
```bash
/bmad-bmm-create-excalidraw-dataflow
```

**–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è:** `diagrams/salary-history-dataflow.excalidraw`

### 6.2 Wireframe
```bash
/bmad-bmm-create-excalidraw-wireframe
```

**–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è:** `diagrams/salary-history-wireframe.excalidraw`

---

## ‚úÖ –ö—Ä–æ–∫ 7: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-check-implementation-readiness
```

**Claude –≤–∏–∫–æ–Ω—É—î adversarial review:**

```
üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PRD, Architecture, —Ç–∞ —ñ–Ω—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤...

‚úÖ PRD: Complete
  - User stories defined
  - Requirements clear
  - Data model specified

‚ùå Issues Found:
  1. PRD –Ω–µ –≤–∫–∞–∑—É—î, —â–æ —Ä–æ–±–∏—Ç–∏ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞–º–∏ –±–µ–∑ —ñ—Å—Ç–æ—Ä—ñ—ó
  2. Architecture –Ω–µ –æ–ø–∏—Å—É—î –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö
  3. –í—ñ–¥—Å—É—Ç–Ω—è –æ–±—Ä–æ–±–∫–∞ edge cases (negative salary, future dates)

üìã Recommendations:
  - –î–æ–¥–∞—Ç–∏ Migration Plan —Å–µ–∫—Ü—ñ—é
  - –û–ø–∏—Å–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
  - –î–æ–¥–∞—Ç–∏ error handling scenarios
```

**–í–∏ –≤–∏–ø—Ä–∞–≤–ª—è—î—Ç–µ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –∑–Ω–æ–≤—É**

```
‚úÖ All checks passed. Ready for implementation.
```

---

## üìñ –ö—Ä–æ–∫ 8: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Epics and Stories

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-create-epics-and-stories
```

**Claude:** –ê–Ω–∞–ª—ñ–∑—É—é PRD —Ç–∞ Architecture...

### –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª:
```
docs/epics-and-stories/epic-salary-history.md
```

### –ó–º—ñ—Å—Ç (–ø—Ä–∏–∫–ª–∞–¥):
```markdown
# Epic: Salary History Tracking

## Epic Overview
Implement salary change tracking with visualization

**Estimated Effort:** 5 stories, ~8 hours

---

## Story 1: Backend - Salary History Data Model
**ID:** SH-001
**Priority:** High
**Depends on:** None

### Description
Create salary_history.csv file structure and API endpoints

### Acceptance Criteria
- [ ] Create data/salary_history.csv with schema
- [ ] GET /api/employees/:id/salary-history endpoint
- [ ] POST /api/employees/:id/salary-history endpoint
- [ ] Validation: date not in future, new_salary > 0
- [ ] Unit tests with 90% coverage

### Technical Notes
- Schema: employee_id;change_date;old_salary;new_salary;reason;changed_by;timestamp
- Auto-generate ID: SH-{timestamp}
- CSV with UTF-8 BOM, `;` delimiter

### Tasks
- [ ] Create salary_history.csv template
- [ ] Add schema definition to schema.js
- [ ] Implement GET endpoint
- [ ] Implement POST endpoint
- [ ] Add validation middleware
- [ ] Write unit tests

---

## Story 2: Backend - Auto-logging salary changes
**ID:** SH-002
**Priority:** High
**Depends on:** SH-001

### Description
Automatically log salary changes when employee record updated

### Acceptance Criteria
- [ ] Middleware detects salary_amount changes
- [ ] Auto-creates salary history entry
- [ ] Preserves old and new values
- [ ] Logs user who made change
- [ ] Does NOT create entry if salary unchanged

### Tasks
- [ ] Create salaryChangeMiddleware.js
- [ ] Integrate in PUT /api/employees/:id
- [ ] Add tests for auto-logging
- [ ] Test edge case: same salary value

---

## Story 3: Frontend - Salary History UI Component
**ID:** SH-003
**Priority:** High
**Depends on:** SH-001

### Description
Display salary history in employee card

### Acceptance Criteria
- [ ] New tab "–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç" in employee card
- [ ] Table displays: Date, Old, New, Change %, Reason
- [ ] Sorted by date descending (newest first)
- [ ] Shows "–ù–µ–º–∞—î —ñ—Å—Ç–æ—Ä—ñ—ó" if empty
- [ ] Loading state while fetching data

### Tasks
- [ ] Add salaryHistory array to component state
- [ ] Create fetchSalaryHistory() method
- [ ] Add tab UI in employee card
- [ ] Create history table template
- [ ] Format currency with spaces (1 000 –≥—Ä–Ω)
- [ ] Calculate and display % change

---

## Story 4: Frontend - Salary History Chart
**ID:** SH-004
**Priority:** Medium
**Depends on:** SH-003

### Description
Visualize salary changes as line chart

### Acceptance Criteria
- [ ] Install and configure Chart.js
- [ ] Line chart below history table
- [ ] X-axis: dates, Y-axis: salary amount
- [ ] Tooltips show exact values
- [ ] Responsive (adapts to card width)
- [ ] Handles 1 data point (shows single dot)

### Tasks
- [ ] npm install chart.js in client
- [ ] Create chart component/method
- [ ] Configure chart options
- [ ] Bind data from salaryHistory
- [ ] Add responsive container

---

## Story 5: Frontend - Add Salary Change Dialog
**ID:** SH-005
**Priority:** Medium
**Depends on:** SH-003

### Description
Allow adding new salary change entries

### Acceptance Criteria
- [ ] "–î–æ–¥–∞—Ç–∏ –∑–º—ñ–Ω—É" button above history table
- [ ] Modal dialog with form: date, new salary, reason
- [ ] Date picker (default: today)
- [ ] Number input for new salary
- [ ] Textarea for reason (optional)
- [ ] Validation: date not future, salary > 0
- [ ] On save: POST to API, refresh table and chart
- [ ] Success/error notifications

### Tasks
- [ ] Create modal dialog component
- [ ] Add form fields
- [ ] Implement validation
- [ ] POST to /api/employees/:id/salary-history
- [ ] Refresh UI after success
- [ ] Error handling

---

## Migration Plan

### Initial data migration
Create salary_history.csv and add initial entry for each employee with current salary:

```csv
employee_id;change_date;old_salary;new_salary;reason;changed_by;timestamp
1;2024-01-01;;;5000;–ü–æ—á–∞—Ç–∫–æ–≤–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞;system;2024-01-01T00:00:00Z
```

### Implementation order
1. SH-001 (backend data)
2. SH-002 (auto-logging)
3. SH-003 (UI table)
4. SH-004 (chart)
5. SH-005 (add dialog)

### Testing strategy
- Unit tests for each API endpoint
- Integration tests for auto-logging
- E2E test: full flow (view ‚Üí add ‚Üí verify)
```

---

## üöÄ –ö—Ä–æ–∫ 9: Sprint Planning

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-sprint-planning
```

### –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª:
```
sprint-status.yaml
```

### –ó–º—ñ—Å—Ç:
```yaml
sprint:
  name: "Sprint 3: Salary History"
  start_date: "2024-02-01"
  end_date: "2024-02-14"

epics:
  - id: "epic-salary-history"
    title: "Salary History Tracking"
    status: "in_progress"
    stories:
      - id: "SH-001"
        title: "Backend - Salary History Data Model"
        status: "ready"
        assigned_to: ""

      - id: "SH-002"
        title: "Backend - Auto-logging salary changes"
        status: "pending"
        assigned_to: ""
        blocked_by: ["SH-001"]

      - id: "SH-003"
        title: "Frontend - Salary History UI Component"
        status: "pending"
        assigned_to: ""
        blocked_by: ["SH-001"]

      - id: "SH-004"
        title: "Frontend - Salary History Chart"
        status: "pending"
        assigned_to: ""
        blocked_by: ["SH-003"]

      - id: "SH-005"
        title: "Frontend - Add Salary Change Dialog"
        status: "pending"
        assigned_to: ""
        blocked_by: ["SH-003"]
```

---

## üíª –ö—Ä–æ–∫ 10: –†–æ–∑—Ä–æ–±–∫–∞ –ø–µ—Ä—à–æ—ó Story

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-dev-story SH-001
```

**Claude:**
```
üìñ Loading story: SH-001 - Backend - Salary History Data Model
üìã Tasks:
  1. Create salary_history.csv template
  2. Add schema definition to schema.js
  3. Implement GET endpoint
  4. Implement POST endpoint
  5. Add validation middleware
  6. Write unit tests

üöÄ Starting implementation...
```

**Claude —Å—Ç–≤–æ—Ä—é—î:**

1. **data/salary_history.template.csv**
```csv
employee_id;change_date;old_salary;new_salary;reason;changed_by;timestamp
```

2. **server/src/schema.js** (–æ–Ω–æ–≤–ª—é—î)
```javascript
const SALARY_HISTORY_COLUMNS = [
  'employee_id',
  'change_date',
  'old_salary',
  'new_salary',
  'reason',
  'changed_by',
  'timestamp'
];
```

3. **server/src/index.js** (–¥–æ–¥–∞—î endpoints)
```javascript
// GET salary history for employee
app.get('/api/employees/:id/salary-history', (req, res) => {
  const { id } = req.params;
  const history = store.getSalaryHistory(id);
  res.json(history);
});

// POST new salary change
app.post('/api/employees/:id/salary-history', (req, res) => {
  const { id } = req.params;
  const { change_date, new_salary, reason } = req.body;

  // Validation
  if (!change_date || !new_salary) {
    return res.status(400).json({ error: 'Missing required fields' });
  }

  if (new Date(change_date) > new Date()) {
    return res.status(400).json({ error: 'Date cannot be in future' });
  }

  if (new_salary <= 0) {
    return res.status(400).json({ error: 'Salary must be positive' });
  }

  const entry = store.addSalaryHistory(id, {
    change_date,
    new_salary,
    reason: reason || '',
    changed_by: 'current_user' // TODO: get from auth
  });

  res.json(entry);
});
```

4. **server/src/store.js** (–¥–æ–¥–∞—î –º–µ—Ç–æ–¥–∏)
```javascript
function getSalaryHistory(employeeId) {
  const history = readCSV('data/salary_history.csv');
  return history.filter(entry => entry.employee_id === employeeId);
}

function addSalaryHistory(employeeId, data) {
  const employee = getEmployeeById(employeeId);
  const history = readCSV('data/salary_history.csv');

  const entry = {
    employee_id: employeeId,
    change_date: data.change_date,
    old_salary: employee.salary_amount || '',
    new_salary: data.new_salary,
    reason: data.reason,
    changed_by: data.changed_by,
    timestamp: new Date().toISOString()
  };

  history.push(entry);
  writeCSV('data/salary_history.csv', history);
  return entry;
}
```

5. **Tests**
```javascript
// server/tests/salary-history.test.js
describe('Salary History API', () => {
  test('GET /api/employees/:id/salary-history returns array', async () => {
    const res = await request(app).get('/api/employees/1/salary-history');
    expect(res.status).toBe(200);
    expect(Array.isArray(res.body)).toBe(true);
  });

  test('POST validates future dates', async () => {
    const futureDate = new Date();
    futureDate.setFullYear(futureDate.getFullYear() + 1);

    const res = await request(app)
      .post('/api/employees/1/salary-history')
      .send({
        change_date: futureDate.toISOString(),
        new_salary: 5000
      });

    expect(res.status).toBe(400);
    expect(res.body.error).toContain('future');
  });

  // ... –±—ñ–ª—å—à–µ —Ç–µ—Å—Ç—ñ–≤
});
```

**Claude –∑–∞–ø—É—Å–∫–∞—î —Ç–µ—Å—Ç–∏:**
```bash
npm test -- salary-history.test.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úì GET /api/employees/:id/salary-history returns array (23ms)
‚úì POST validates future dates (15ms)
‚úì POST validates positive salary (12ms)
‚úì POST creates history entry (45ms)

Tests: 4 passed, 4 total
Coverage: 92%
```

**Claude –æ–Ω–æ–≤–ª—é—î sprint-status.yaml:**
```yaml
- id: "SH-001"
  status: "completed"  # was "ready"
  completed_date: "2024-02-01"
```

---

## üîç –ö—Ä–æ–∫ 11: Code Review

### –ö–æ–º–∞–Ω–¥–∞ (–ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó story):
```bash
/bmad-bmm-code-review SH-001
```

**Claude (ADVERSARIAL —Ä–µ–∂–∏–º):**

```
üî¥ CRITICAL ISSUES (must fix):

1. **Security vulnerability** - No authentication check
   Location: server/src/index.js:145
   Issue: changed_by hardcoded as 'current_user', no JWT validation
   Fix: Add auth middleware, extract user from token

2. **Data integrity** - Race condition in addSalaryHistory
   Location: server/src/store.js:78
   Issue: Read-modify-write without locking
   Fix: Use file locking or atomic writes

3. **Missing error handling** - File not found
   Location: server/src/store.js:72
   Issue: readCSV will crash if salary_history.csv doesn't exist
   Fix: Check file existence, create if missing

üü° WARNINGS (should fix):

4. **Performance** - Loading entire CSV on each request
   Impact: Will slow down with large history (>1000 records)
   Suggestion: Add caching or pagination

5. **Validation** - Missing salary range check
   Issue: Accepts unrealistic values (9999999999)
   Fix: Add max salary validation (e.g., 1,000,000)

üîµ SUGGESTIONS (nice to have):

6. **Code quality** - Duplicate date validation
   Suggestion: Extract to validateSalaryChange() helper

7. **Testing** - Missing edge case test
   Missing: Test with employee that has no salary_amount

---

üìä Coverage: 92% (target: 90%) ‚úÖ
üîí Security scan: 2 issues ‚ùå
üìê Architecture compliance: Pass ‚úÖ

**Verdict:** 3 critical issues must be fixed before merge
```

**–í–∏ –≤–∏–ø—Ä–∞–≤–ª—è—î—Ç–µ –ø—Ä–æ–±–ª–µ–º–∏ —ñ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ review –∑–Ω–æ–≤—É**

```
‚úÖ All issues resolved. Code approved.
```

---

## üîÑ –ö—Ä–æ–∫ 12: –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ä–æ–∑—Ä–æ–±–∫–∏

```bash
/bmad-bmm-dev-story SH-002  # Auto-logging
/bmad-bmm-code-review SH-002

/bmad-bmm-dev-story SH-003  # Frontend UI
/bmad-bmm-code-review SH-003

/bmad-bmm-dev-story SH-004  # Chart
/bmad-bmm-code-review SH-004

/bmad-bmm-dev-story SH-005  # Add dialog
/bmad-bmm-code-review SH-005
```

---

## üß™ –ö—Ä–æ–∫ 13: QA Automation

### –ö–æ–º–∞–Ω–¥–∞:
```bash
/bmad-bmm-qa-automate
```

**Claude:** –î–ª—è —è–∫–æ—ó —Ñ—ñ—á—ñ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–µ—Å—Ç–∏?

**–í–∏:** Salary History (–≤—Å—ñ stories SH-001 –¥–æ SH-005)

**Claude —Å—Ç–≤–æ—Ä—é—î:**

```javascript
// client/tests/e2e/salary-history.spec.js
describe('Salary History E2E', () => {
  it('should display salary history in employee card', () => {
    cy.visit('/');
    cy.get('[data-test="employee-card-1"]').click();
    cy.get('[data-test="tab-salary-history"]').click();

    cy.get('[data-test="salary-history-table"]').should('be.visible');
    cy.get('[data-test="salary-history-chart"]').should('be.visible');
  });

  it('should add new salary change', () => {
    cy.visit('/?employee=1');
    cy.get('[data-test="tab-salary-history"]').click();
    cy.get('[data-test="btn-add-change"]').click();

    cy.get('[data-test="input-change-date"]').type('2024-02-01');
    cy.get('[data-test="input-new-salary"]').type('6000');
    cy.get('[data-test="input-reason"]').type('Annual raise');
    cy.get('[data-test="btn-save"]').click();

    cy.get('[data-test="salary-history-table"]')
      .should('contain', '6000')
      .should('contain', 'Annual raise');
  });

  // ... more tests
});
```

---

## üìä –ö—Ä–æ–∫ 14: Sprint Status

### –ö–æ–º–∞–Ω–¥–∞ (–≤ –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç):
```bash
/bmad-bmm-sprint-status
```

**Output:**
```
üìä Sprint 3: Salary History
üóìÔ∏è  Feb 1 - Feb 14 (5 days remaining)

Epic: Salary History Tracking [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 80%

Stories:
‚úÖ SH-001: Backend - Data Model (completed)
‚úÖ SH-002: Backend - Auto-logging (completed)
‚úÖ SH-003: Frontend - UI Component (completed)
‚úÖ SH-004: Frontend - Chart (completed)
üîÑ SH-005: Frontend - Add Dialog (in progress)

‚ö†Ô∏è  Risks:
  - SH-005 in progress, 1 day remaining

üí° Suggestion: Run /bmad-bmm-dev-story SH-005 to complete
```

---

## üéâ –ö—Ä–æ–∫ 15: Retrospective

### –ö–æ–º–∞–Ω–¥–∞ (–ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è epic):
```bash
/bmad-bmm-retrospective epic-salary-history
```

**Claude:** –ê–Ω–∞–ª—ñ–∑—É—é epic —Ç–∞ stories...

**Output:**
```markdown
# Retrospective: Salary History Epic

## Success Metrics
‚úÖ All 5 stories completed
‚úÖ 0 critical bugs in production
‚úÖ User feedback: positive (HR loves the chart!)
‚è±Ô∏è  Completed in 6 days (estimate: 7 days)

## What Went Well üéâ
1. Clear architecture decisions saved time
2. ADVERSARIAL code review caught security issues early
3. Auto-logging worked perfectly from day 1
4. Chart.js integration was simpler than expected

## What Didn't Go Well üòû
1. Forgot to handle employees with no history (SH-003)
2. Had to refactor CSV reading twice (performance issue)
3. Initial estimate for SH-005 was too low (3h ‚Üí 5h actual)

## Lessons Learned üìö
1. **Always validate with empty state** - test with no data first
2. **Performance testing early** - load 1000 records during development
3. **Buffer estimates** - UI work takes longer than expected

## New Information Emerged üí°
1. Users want to **export history to Excel** (new feature request)
2. Accounting needs **approval workflow** for salary changes
3. Chart should show **comparison with department average**

## Actionable Items for Next Epic
- [ ] Add "Export to Excel" to backlog (priority: medium)
- [ ] Research approval workflow patterns
- [ ] Consider adding department analytics view

## Impact on Future Work
This epic proved that:
- CSV-based approach scales to relational data
- Chart.js is good fit for this project
- Auto-logging pattern can be reused for other entities

Recommend using similar approach for:
- Vacation history
- Position changes
- Performance reviews
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

```
crm_manufactur/
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ product-brief-salary-history.md          # –ö—Ä–æ–∫ 2
‚îÇ   ‚îú‚îÄ‚îÄ prd-salary-history.md                    # –ö—Ä–æ–∫ 3
‚îÇ   ‚îú‚îÄ‚îÄ architecture-salary-history.md           # –ö—Ä–æ–∫ 4
‚îÇ   ‚îú‚îÄ‚îÄ ux-design-salary-history.md             # –ö—Ä–æ–∫ 5
‚îÇ   ‚îî‚îÄ‚îÄ epics-and-stories/
‚îÇ       ‚îî‚îÄ‚îÄ epic-salary-history.md               # –ö—Ä–æ–∫ 8
‚îú‚îÄ‚îÄ diagrams/
‚îÇ   ‚îú‚îÄ‚îÄ salary-history-dataflow.excalidraw       # –ö—Ä–æ–∫ 6.1
‚îÇ   ‚îî‚îÄ‚îÄ salary-history-wireframe.excalidraw      # –ö—Ä–æ–∫ 6.2
‚îú‚îÄ‚îÄ sprint-status.yaml                            # –ö—Ä–æ–∫ 9, –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ salary_history.csv                        # –°—Ç–≤–æ—Ä–µ–Ω–æ –≤ SH-001
‚îÇ   ‚îî‚îÄ‚îÄ salary_history.template.csv
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js                              # –û–Ω–æ–≤–ª–µ–Ω–æ (endpoints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store.js                              # –û–Ω–æ–≤–ª–µ–Ω–æ (–º–µ—Ç–æ–¥–∏)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.js                             # –û–Ω–æ–≤–ª–µ–Ω–æ (schema)
‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îÇ       ‚îî‚îÄ‚îÄ salary-history.test.js                # –°—Ç–≤–æ—Ä–µ–Ω–æ –≤ SH-001
‚îî‚îÄ‚îÄ client/
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îî‚îÄ‚îÄ App.vue                                # –û–Ω–æ–≤–ª–µ–Ω–æ (UI)
    ‚îî‚îÄ‚îÄ tests/
        ‚îî‚îÄ‚îÄ e2e/
            ‚îî‚îÄ‚îÄ salary-history.spec.js             # –ö—Ä–æ–∫ 13
```

---

## ‚è±Ô∏è –ó–∞—Ç—Ä–∞—á–µ–Ω–∏–π —á–∞—Å

| –ö—Ä–æ–∫ | –ö–æ–º–∞–Ω–¥–∞ | –ß–∞—Å |
|------|---------|-----|
| 1 | Design Thinking | 30 —Ö–≤ |
| 2 | Product Brief | 15 —Ö–≤ |
| 3 | PRD | 20 —Ö–≤ |
| 4 | Architecture | 25 —Ö–≤ |
| 5 | UX Design | 20 —Ö–≤ |
| 6 | –î—ñ–∞–≥—Ä–∞–º–∏ | 15 —Ö–≤ |
| 7 | Readiness Check | 10 —Ö–≤ |
| 8 | Epics & Stories | 15 —Ö–≤ |
| 9 | Sprint Planning | 5 —Ö–≤ |
| 10 | Dev SH-001 | 45 —Ö–≤ |
| 11 | Code Review | 10 —Ö–≤ |
| 12 | Dev SH-002-005 | 4 –≥–æ–¥ |
| 13 | QA Automation | 30 —Ö–≤ |
| 15 | Retrospective | 15 —Ö–≤ |
| **TOTAL** | | **~7 –≥–æ–¥–∏–Ω** |

*(–ë–µ–∑ BMAD —Ü–µ –∑–∞–π–Ω—è–ª–æ –± ~12-15 –≥–æ–¥–∏–Ω)*

---

## üéØ –ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏

### –©–æ –¥–∞—î BMAD:
1. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥** - –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–∞–±—É–≤–∞—î—Ç—å—Å—è
2. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –Ω–∞ –∞–≤—Ç–æ–ø—ñ–ª–æ—Ç—ñ** - –≤—Å–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω–æ
3. ‚úÖ **–†–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** - –ø—Ä–æ–±–ª–µ–º–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –¥–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è
4. ‚úÖ **–Ø–∫—ñ—Å—Ç—å –∫–æ–¥—É** - adversarial review –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ñ issues
5. ‚úÖ **–®–≤–∏–¥–∫—ñ—Å—Ç—å** - 40% –µ–∫–æ–Ω–æ–º—ñ—è —á–∞—Å—É
6. ‚úÖ **–Ü—Å—Ç–æ—Ä—ñ—è —Ä—ñ—à–µ–Ω—å** - —á–æ–º—É –∑—Ä–æ–±–ª–µ–Ω–æ —Å–∞–º–µ —Ç–∞–∫

### –ö–æ–ª–∏ –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –∫—Ä–æ–∫–∏:
- **–®–≤–∏–¥–∫–∏–π —Ñ—ñ–∫—Å** ‚Üí –æ–¥—Ä–∞–∑—É –¥–æ `/bmad-bmm-quick-dev`
- **–ü—Ä–æ—Å—Ç–∞ –∑–º—ñ–Ω–∞ UI** ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ Architecture
- **–î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–ª—è** ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ Design Thinking —Ç–∞ UX

### –ö–æ–ª–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –≤—Å–µ:
- **–ù–æ–≤–∞ –∑–Ω–∞—á–Ω–∞ —Ñ—ñ—á–∞** (—è–∫ –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ)
- **–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –∑–º—ñ–Ω–∏**
- **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏**

---

**–ü–æ—Ä–∞–¥–∞:** –ö–æ–ø—ñ—é–π—Ç–µ —Ü–µ–π workflow –¥–ª—è –≤–∞—à–∏—Ö —Ñ—ñ—á! üöÄ
